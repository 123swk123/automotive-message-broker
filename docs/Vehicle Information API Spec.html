<!DOCTYPE html>
<html>
  <head>
    <title>Vehicle Information API</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <!--<script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            class='remove'></script>
    <script class="remove">
      var respecConfig = {
          specStatus:           "",
          shortName:            "vehicle-information-api",
          publishDate:          "",
          previousPublishDate:  "",
          previousMaturity:     "",
          edDraftURI:           "",
          // lcEnd:                "",
          crEnd:                "",
          editors:  [
              { name: "Kevron Rees", company: "Intel",
                      companyURL: "http://www.intel.com" }
         ],
          inlineCSS:    true,
          noIDLIn:      true,
          extraCSS:     ["../ReSpec.js/css/respec.css"],
          wg:           "",
          wgURI:        "http://",
          wgPublicList: "",
          wgPatentURI:  "",
      };
    </script> -->
  </head>

  <body>

<!------------------------------ Abstract ------------------------------------>    
<section id="abstract">
  This specification defines a Vehicle Information API which offers a simple interface
  to get access to vehicle data. A typical use case of the Vehicle Information is the
  implementation of a tachometer application that allows view inforomation from the
  vehicle such as speed, tire pressure, and engine rotation speed (RPMs).
</section>

<!----------------------- Status of this document ---------------------------->    
<section id="sotd">
</section>
    
<!----------------------------- Introduction --------------------------------->
<section class="informative">
  <h2>Introduction</h2>
  <p>
    The Vehicle Information API provides operations to get access to the vehicle data
    (henceforth "properties") available from vehicle systems and also to change (write) a number of
    properties.  The API also allows users to request data that has been logged previously.
  <p>
    An example of use is provided below:
  
  <pre class="example highlight">
        navigator.vehicle.get(navigator.vehicle.EngineSpeed, onsuccess, onerror);
          
        function onsuccess(value) {
                window.console.log(value.EngineSpeed);
        }
        function onerror(e) {
                window.console.error(e.message);
        }
  </pre>
</section>
    
<!---------------------------- Conformance ----------------------------------->
<section id="conformance">
  <p>This specification defines conformance criteria that apply to a single
  product: the <dfn>user agent</dfn> that implements the interfaces that it
  contains.
  
  <p>Implementations that use ECMAScript to implement the APIs defined in this
  specification MUST implement them in a manner consistent with the ECMAScript
  Bindings defined in the Web IDL specification [[!WEBIDL]], as this
  specification uses that specification and terminology.
</section>
    
<!----------------------------- Terminology ---------------------------------->
<section>
  <h2>Terminology</h2> <p>The <code><a
  href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
  EventHandler</a></code> interface represents a callback used for event
  handlers as defined in [[!HTML5]].
  
  <p>The concepts <dfn><a
  href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task"> queue a
  task</a></dfn> and <dfn><a
  href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
  fire a simple event</a></dfn> are defined in [[!HTML5]].
  
  <p>The terms <a
  href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers"><dfn
  id="dfn-eventhandler">event handler</dfn></a> and <a
  href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
  <dfn id="dfn-eventtypes"> event handler event types</dfn></a> are defined in
  [[!HTML5]]. 
</section>

<!------------------------ Security and privacy ------------------------------>
<section>
      <h2>Security and privacy considerations</h2>
      <p>This API must be only exposed to trusted content
</section>

<!---------------------- Extended interface Navigator ------------------------>
<section>
  <h2><a>Navigator</a> Interface</h2>
    <dl title="partial interface Navigator" class="idl">
      <dt>readonly attribute Vehicle vehicle</dt>
      <dd>
      The object that exposes the interface to vehicle information services.
      </dd>
  </dl>
</section>
    
<!------------------------ Interface Vehicle ------------------------------->
<section>
  <h2><a>Vehicle Information</a> Interface</h2> <p>The <a>Vehicle Infomration</a> interface
  represents the initial entry point for getting access to the vehicle information
  services, i.e. Engine Speed and Tire Pressure.
  
  <dl title="[NoInterfaceObject] interface Vehicle" class="idl">

    <dt>getSupported ()</dt> <dd>Preturns supported properties.
       <dl class='parameters'>  
          <dt>SupportedPropertiesCallback successCallback</dt><dd>function to be called when method
          has completed successfully</dd>
          <dt>VehiclePropertyErrorCallback errorCallback</dt><dd>this function is called
          when an error has occured</dd>
       </dl></dd>
    </dd>
  
    <dt>get ()</dt> <dd>fetch the current value for <code>property</code>.  Upon
    success, the <code>successCallback</code> will be called with the value.
       <dl class='parameters'>
          <dt>DOMString property</dt><dd>requested property to be retrieved</dd>
          <dt>VehiclePropertyCallback success</dt><dd>function to be called when method
          has completed successfully</dd>
          <dt>VehiclePropertyErrorCallback errorCallback</dt><dd>this function is called
          when an error has occured</dd></dd>
       </dl>
    </dd>
  
    <dt>set ()</dt> <dd>set the <code>property</code> to <code>value</code>.  Upon
    success, the <code>successCallback</code> will be called with the result.
       <dl class='parameters'>
          <dt>DOMString property</dt><dd>requested property to be retrieved</dd>
          <dt>VehiclePropertyType value</dt><dd>corrisponding value to set</dd>
          <dt>VehiclePropertyCallback success</dt><dd>function to be called when method
          has completed successfully</dd>
          <dt>VehiclePropertyErrorCallback errorCallback</dt><dd>this function is called
          when an error has occured</dd></dd>
       </dl>
    </dd>

    <dt>getHistory ()</dt> <dd>get the <code>property</code> in series from <code>startTime</code>
    to <code>endTime</code>.  Upon success, the <code>successCallback</code> will be called 
    with the result.
       <dl class='parameters'>
          <dt>DOMString property</dt><dd>requested property to be retrieved</dd>
          <dt>Date startTime</dt><dd>beginning time for request</dd>
          <dt>Date endTime</dt><dd>ending time for request</dd>
          <dt>VehiclePropertyListCallback success</dt><dd>function to be called when method
          has completed successfully</dd>
          <dt>VehiclePropertyErrorCallback errorCallback</dt><dd>this function is called
          when an error has occured</dd></dd>
       </dl>
    </dd>

  </dl>
   
  <section>
  <h3>Steps</h3>
  <p> The <dfn><code>getSupported</code></dfn>
  method when invoked MUST run the following steps:
    <ol>
     <li>Make a request to the system to get the vehicle information properties(s) 
     supported by the system.
     <li>Create a new array of DOMString for all supported properties in the system.
     <li>When the request has been completed:
     <ol>
      <li>call <code>successCallback</code> and pass into the function the 
      DOMString array representing the supported properties.
      <li>If an error has occured, construct a VehiclePropertyError object and set the
      message and code appropriatly for the error.
    </ol>
   </ol>
     
  <p> The <dfn><code>get</code></dfn> method when invoked MUST
  run the following steps:
    <ol>
     <li>Make a request to the system to get the property indicated in the 
     <code>property</code> parameter
     <li>If the <code>property</code> is not supported construct a <code>VehiclePropertyError</code>
     object and set the <code>code</code> members to <code>VehiclePropertyError.PROPERTY_UNAVAILABLE</code> and
     <code>message</code> member to "Unsupported property".
     <li>When the request has been completed:
     <ol>
      <li>if successful invoke the <code>successCallback</code> and pass the <code>VehiclePropertyType</code>
      as the argument.
      <li>if there has been an error, construct a VehiclePropertyError object and set the
      message and code appropriatly for the error.
    </ol>
   </ol>
     
  <p> The <dfn><code>set</code></dfn> method when invoked MUST run
  the following steps:
    <ol>
     <li>Make a request to the system to set the property indicated in the 
     <code>property</code> parameter to the value indicated in the <code>value</code> parameter.
     <li>If the <code>property</code> is not supported construct a <code>VehiclePropertyError</code>
     object and set the <code>code</code> members to <code>VehiclePropertyError.PROPERTY_UNAVAILABLE</code> and
     <code>message</code> member to "Unsupported property".
     <li>When the request has been completed:
     <ol>
      <li>if successful invoke the <code>successCallback</code> and pass the <code>VehiclePropertyType</code>
      as the argument.
      <li>if there has been an error, construct a VehiclePropertyError object and set the
      message and code appropriatly for the error.
    </ol>
   </ol>

  <p> The <dfn><code>getHistory</code></dfn> method when invoked MUST run
  the following steps:
    <ol>
     <li>Make a request to the system to get the values for the property indicated in the 
     <code>property</code> parameter after the time <code>startTime</code> and after
     the time <code>endTime</code>.
     <li>If the <code>property</code> is not supported construct a <code>VehiclePropertyError</code>
     object and set the <code>code</code> members to <code>VehiclePropertyError.PROPERTY_UNAVAILABLE</code> and
     <code>message</code> member to "Unsupported property".
     <li>When the request has been completed:
     <ol>
      <li>if successful invoke the <code>successCallback</code> and pass the array of <code>VehiclePropertyType</code>
      as the argument.
      <li>if there has been an error, construct a VehiclePropertyError object and set the
      message and code appropriatly for the error.
    </ol>
   </ol>
   
  </section>
</section>

<!------------------------ Interface VehiclePropertyType ------------------------>
<section>
  <h2><a>VehiclePropertyType</a> Interface</h2> <p>The <a>VehiclePropertyType</a>
  interface represents the base interface for all vehicle properties.
  
  <dl title="[NoInterfaceObject] interface VehiclePropertyType"
  class="idl">

    <dt>readonly attribute Date timeStamp;</dt> <dd>MUST return the type time at which this property was
    recieved.</dd>
     
  </dl>
</section>

<!------------------------ Interface VehiclePropertyError ------------------------------>
<section>
  <h2><a>VehiclePropertyError</a> Interface</h2>
  <p>The <a>VehiclePropertyError</a> interface represents the an error returned by the vehicle information system.
  manager.
  <dl title="[NoInterfaceObject] interface VehiclePropertyError">
     <dt class="no-docs">const unsigned short PERMISSION_DENIED = 1 </dt>
     <dt class="no-docs">const unsigned short PROPERTY_UNAVAILABLE = 2</dt> 
	 <dt class="no-docs">const unsigned short TIMEOUT = 3</dt>
	 <dt class="no-docs">const unsigned short UNKNOWN = 10</dt>
	
     <dt>readonly attribute unsigned short code</dt>
     <dd> MUST return error code. </dd>
     <dt>readonly attribute DOMString message<dt>
     <dd>MUST return error message</dd>

  </dl>
</section>  

<!------------------------ Callback VehiclePropertyCallback------------------------------>
<section>
  <h2><a>VehiclePropertyCallback</a> Callback</h2>
  <p>The <a>VehiclePropertyCallback</a> is called during the <code>navigator.vehicle.get()</code> operation
  <dl title="callback VehiclePropertyCallback = void (VehiclePropertyType value)"></dl>
</section> 

<!------------------------ Callback VehiclePropertyErrorCallback------------------------------>
<section>
  <h2><a>VehiclePropertyErrorCallback</a> Callback</h2>
  <p>The <a>VehiclePropertyErrorCallback</a> is called during the <code>navigator.vehicle.get()</code> operation
  <dl title="callback VehiclePropertyErrorCallback = void (VehiclePropertyError error); "></dl>
</section> 

<!------------------------ Callback VehiclePropertyListCallback------------------------------>
<section>
  <h2><a>VehiclePropertyListCallback</a> Callback</h2>
  <p>The <a>VehiclePropertyListCallback</a> is called during the <code>navigator.vehicle.getHistory()</code> operation
  <dl title="callback VehiclePropertyListCallback = (sequence<VehiclePropertyType> values)"></dl>
</section> 

<!------------------------ Callback VehiclePropertyListCallback------------------------------>
<section>
  <h2><a>SupportedPropertiesCallback</a> Callback</h2>
  <p>The <a>SupportedPropertiesCallback</a> is called during the <code>navigator.vehicle.getSupported()</code> operation
  <dl title="callback SupportedPropertiesCallback = void (sequence<DOMString> properties)"></dl>
</section> 

<!------------------------ Interface VehicleSpeed ------------------------------>
<section>
  <h2><a>VehicleSpeed</a> Interface</h2>
  <p>The <a>VehicleSpeed</a> interface represents vehicle speed.
  <dl title="[NoInterfaceObject] interface VehicleSpeed : VehiclePropertyType">
     <dt>readonly attribute unsigned long VehicleSpeed</dt>
     <dd>Must return Vehicle Speed in kilometers per hour.</dd>
  </dl>
</section>

<!------------------------ Interface EngineSpeed ------------------------------>
<section>
  <h2><a>EngineSpeed</a> Interface</h2>
  <p>The <a>EngineSpeed</a> interface represents vehicle speed.
  <dl title="[NoInterfaceObject] interface EngineSpeed : VehiclePropertyType">
     <dt>readonly attribute unsigned long EngineSpeed</dt>
     <dd>Must return Engine Speed in rotations per minute.</dd>
  </dl>
</section>

<!------------------------ Interface VehiclePowerMode ------------------------------>
<section>
  <h2><a>VehiclePowerMode</a> Interface</h2>
  <p>The <a>VehiclePowerMode</a> interface represents vehicle speed.
  <dl title="[NoInterfaceObject] interface VehiclePowerMode : VehiclePropertyType">
     <dt class="no-docs">const unsigned short VEHICLEPOWERMODE_OFF = 0</dt>
     <dt class="no-docs">const unsigned short VEHICLEPOWERMODE_ACCESSORY1 = 1</dt>
     <dt class="no-docs">const unsigned short VEHICLEPOWERMODE_ACCESSORY2 = 2</dt>
     <dt class="no-docs">const unsigned short VEHICLEPOWERMODE_RUN = 3</dt>
     <dt>readonly attribute octet VehiclePowerMode</dt>
     <dd> Must return Vehicle Power mode (see VEHICLEPOWERMODE)</dd>
  </dl>
</section>

<!------------------------ Interface TripMeters ------------------------------>
<section>
  <h2><a>TripMeters</a> Interface</h2>
  <p>The <a>TripMeters</a> interface represents vehicle speed.
  <dl title="[NoInterfaceObject] interface TripMeters : VehiclePropertyType">
     <dt>attribute sequence<unsigned long> TripMeters</dt>
     <dd>Must return trip meters.  Changing any items in the array will reset the item's value to '0'.</dd>
  </dl>
</section>

<!------------------------ Dictionary FilterOptions -------------------------->
<section>
  <h2><a>FilterOptions</a> Dictionary</h2>
  <dl title="dictionary FilterOptions" class="idl">
    <dt>DOMString sortBy</dt>
    <dd>Indicates the attribute on which the filtered messages are sorted.</dd>

    <dt>optional DOMString sortOrder</dt>
    <dd>Indicates the order on which the filtered messages are sorted with
    possible values 'ascending' and 'descending'.</dd>

    <dt>unsigned long limit</dt>
    <dd>Indicates the maximum number of messages that can be returned as a
    result of applying the corresponding filter.</dd>

  </dl>    
</section>


  <p class="issue">
  It needs to be discussed whether to just allow using the above
  messaging-specific MessagingFilter or otherwise to allow defining filters with
  a generic syntax (as defined in the following sections) and reflect in this
  specification on which attributes the implementation is required to filter in
  an efficient manner (e.g. creating the corresponding indexes).
  </p>

<!------------------------ Acknowledgements ---------------------------------->
<section>
  <h2>Acknowledgements</h2>
  <p>The editors would like to express their gratitude to the Mozilla B2G Team
  and specially to Jonas Sicking, Mounir Lamouri and Vicamo Yang for their
  technical guidance, implementation work and support.</p>
</section>

  </body>
</html>
